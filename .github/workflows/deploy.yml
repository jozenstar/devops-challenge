name: 'SSH Deploy'

on:
  push:

jobs:
  Deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout env repo
        uses: actions/checkout@v2.3.2
        with:
          repository: jozenstar/devops-challenge_env
          ref: master
      - name: Copy docker-compose.yml and restart
        # You may pin to the exact commit or the version.
        # uses: cross-the-world/ssh-scp-ssh-pipelines@e1c2bf0c8d7813a3243dc649b6af178262a834e9
        uses: cross-the-world/ssh-scp-ssh-pipelines@latest
        with:
          # ssh remote host
          host: 18.197.30.79
          # ssh remote user
          user: ubuntu
          # content of ssh private key. ex raw content of ~/.ssh/id_rsa
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          # execute pre-commands before scp
#          first_ssh: |
          # scp from local to remote
          scp: |
            './docker-compose.yml' => /home/ubuntu/app/
            './nginx' => /home/ubuntu/app/
          # execute post-commands after scp
          last_ssh: |
            cd /home/ubuntu/app
            docker-compose up -d
